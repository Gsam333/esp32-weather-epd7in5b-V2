# 传感器集成需求文档

## 介绍

本项目需要将子工程中成功运行的BMP280和AHT20双传感器功能集成到主工程中，解决主工程中传感器无法发现和初始化的问题，并将传感器数据正确传递给墨水屏显示。

## 需求

### 需求1：传感器电源管理修复

**用户故事：** 作为开发者，我希望主工程中的传感器能够正常初始化，以便获取准确的环境数据。

#### 验收标准
1. WHEN 主程序启动 THEN GPIO4应该设置为高电平并保持
2. WHEN 传感器初始化时 THEN GPIO4应该保持3.3V电平
3. WHEN 传感器读取完成后 THEN GPIO4应该继续保持高电平（不再设置为LOW）
4. IF 传感器需要重新初始化 THEN GPIO4应该始终保持供电状态

### 需求2：BMP280传感器集成

**用户故事：** 作为用户，我希望系统能够读取BMP280的气压数据，并在墨水屏上正确显示。

#### 验收标准
1. WHEN 系统启动时 THEN 应该能够发现BMP280传感器（地址0x77）
2. WHEN BMP280初始化成功 THEN 应该能够读取温度和气压数据
3. WHEN 获取到气压数据 THEN 应该将数据传递给墨水屏显示模块
4. IF BMP280读取失败 THEN 应该显示错误信息而不是崩溃

### 需求3：AHT20传感器集成

**用户故事：** 作为用户，我希望系统能够读取AHT20的温湿度数据，并在墨水屏上显示室内环境信息。

#### 验收标准
1. WHEN 系统启动时 THEN 应该能够发现AHT20传感器（地址0x38）
2. WHEN AHT20初始化成功 THEN 应该能够读取温度和湿度数据
3. WHEN 获取到温湿度数据 THEN 应该将数据传递给墨水屏的室内显示区域
4. IF AHT20读取失败 THEN 应该显示默认值或错误信息

### 需求4：I2C总线管理

**用户故事：** 作为开发者，我希望I2C总线能够稳定地支持多个传感器，避免冲突和通信错误。

#### 验收标准
1. WHEN 系统初始化时 THEN 应该正确配置I2C总线（SDA=GPIO17, SCL=GPIO16）
2. WHEN 多个传感器连接时 THEN 应该能够依次访问每个传感器
3. WHEN 传感器通信失败时 THEN 应该有重试机制
4. IF I2C总线出现错误 THEN 应该能够重新初始化总线

### 需求5：代码清理

**用户故事：** 作为开发者，我希望移除测试代码，保持主工程的整洁性。

#### 验收标准
1. WHEN 集成完成后 THEN 应该移除所有GPIO测试相关代码
2. WHEN 清理代码后 THEN 主程序应该只包含生产功能
3. WHEN 编译时 THEN 不应该有未使用的测试函数警告
4. IF 需要调试 THEN 应该通过调试标志控制而不是测试代码

### 需求6：显示集成

**用户故事：** 作为用户，我希望在墨水屏上看到完整的环境数据，包括室内和室外信息。

#### 验收标准
1. WHEN BMP280数据可用时 THEN 气压应该显示在指定区域
2. WHEN AHT20数据可用时 THEN 室内温湿度应该显示在指定区域
3. WHEN 传感器数据更新时 THEN 显示应该相应更新
4. IF 传感器数据无效 THEN 应该显示适当的占位符或错误信息