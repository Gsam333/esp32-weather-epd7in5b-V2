# Serena + Claude 协作开发指南

## 🎯 协作原理

Serena通过自动生成详细的项目知识库，为Claude提供完整的项目上下文，让Claude能够：

- 🧠 **理解项目架构**：了解代码结构、技术栈、依赖关系
- 🎯 **提供精准建议**：基于现有代码风格和架构模式
- 🔄 **保持一致性**：确保新代码与现有项目风格一致
- ⚡ **加速开发**：减少解释项目背景的时间

## 📋 协作流程

### 1. 准备阶段

```bash
# 确保知识库是最新的
./.kiro/serena/scripts/update-knowledge.sh

# 查看项目知识库
cat .kiro/serena/knowledge/project-knowledge-base.md
```

### 2. 与Claude对话

#### 标准开场白模板

```
我正在开发一个项目，以下是详细的项目信息：

[复制粘贴 .kiro/serena/knowledge/project-knowledge-base.md 的内容]

基于这些项目信息，我想要实现以下功能：
[描述你的具体需求]

请提供详细的实现方案，包括：
1. 在现有架构中的集成方式
2. 具体的代码实现
3. 需要修改的文件
4. 测试和验证方法
```

#### 简化版本（适用于小需求）

```
项目类型：[从知识库复制]
技术栈：[从知识库复制]
现有架构：[从知识库复制关键架构信息]

需求：[具体描述]
```

### 3. 获得建议后

```bash
# 实现代码后，更新知识库
./.kiro/serena/scripts/update-knowledge.sh

# 重新分析代码
./.kiro/serena/scripts/analyze-code.sh
```

## 💡 最佳实践

### 提问技巧

#### ✅ 好的提问方式

```
基于项目知识库中的ESP32架构信息，我想添加BH1750光照传感器支持。
现有项目已经使用I2C与BME280通信，请帮我：
1. 分析I2C地址冲突问题
2. 设计传感器集成方案
3. 提供具体代码实现
4. 考虑功耗优化
```

#### ❌ 不好的提问方式

```
帮我添加一个传感器
```

### 上下文管理

#### 完整上下文（推荐）
- 包含完整的项目知识库
- 明确描述当前状态
- 具体说明需求和约束

#### 增量上下文
- 引用之前的对话
- 提供变更的部分
- 说明新的需求

### 代码实现后的反馈

```
我已经按照你的建议实现了代码，以下是更新后的项目统计：

[复制 .kiro/serena/analysis/code-analysis.md 的相关部分]

请帮我review代码并提供优化建议。
```

## 🔧 不同项目类型的协作模式

### ESP32/嵌入式项目

**重点信息：**
- 硬件配置和引脚分配
- 功耗要求和优化策略
- 实时性和中断处理
- 内存和存储限制

**典型对话：**
```
基于项目知识库，这是一个ESP32低功耗天气显示项目。
现有架构使用Deep Sleep实现14μA功耗。
我想添加[新功能]，请确保：
1. 不影响现有功耗表现
2. 与现有I2C/SPI接口兼容
3. 符合Arduino框架规范
```

### Node.js/Web项目

**重点信息：**
- 前端框架和状态管理
- API设计和数据流
- 性能优化和缓存策略
- 用户体验和响应式设计

**典型对话：**
```
这是一个基于React的Web应用项目。
现有架构使用Redux管理状态，Express提供API。
我想实现[新功能]，请考虑：
1. 与现有状态管理的集成
2. API设计的RESTful规范
3. 前端组件的复用性
4. 性能和用户体验
```

### Python项目

**重点信息：**
- 包管理和虚拟环境
- 代码风格和类型注解
- 测试框架和覆盖率
- 性能优化和异步处理

**典型对话：**
```
这是一个Python数据处理项目，使用pandas和numpy。
现有架构采用模块化设计，有完整的单元测试。
我想添加[新功能]，请确保：
1. 符合PEP 8代码规范
2. 包含类型注解
3. 编写对应的单元测试
4. 考虑性能优化
```

## 📊 协作效果评估

### 成功指标

- ✅ **代码一致性**：新代码风格与现有项目一致
- ✅ **架构兼容**：新功能无缝集成到现有架构
- ✅ **最佳实践**：遵循项目既定的开发规范
- ✅ **完整性**：包含测试、文档、错误处理

### 常见问题

#### 上下文不足
**症状**：Claude提供的建议过于通用，不符合项目特点
**解决**：提供更完整的项目知识库信息

#### 需求不明确
**症状**：Claude询问太多细节问题
**解决**：在提问时明确说明具体需求和约束条件

#### 代码风格不一致
**症状**：生成的代码与现有项目风格差异较大
**解决**：在知识库中强调项目的代码规范和风格要求

## 🚀 高级协作技巧

### 迭代式开发

```
第一轮：基础功能实现
第二轮：基于第一轮结果的优化
第三轮：集成测试和错误处理
第四轮：性能优化和文档完善
```

### 多轮对话管理

```
对话1：架构设计和方案确认
对话2：核心功能实现
对话3：测试和验证
对话4：优化和完善
```

### 知识库增强

定期更新知识库，包含：
- 新增的设计决策
- 重要的技术选型理由
- 性能优化的经验
- 常见问题的解决方案

## 📝 协作记录

### 建议的记录格式

```markdown
## 协作记录 - [日期]

### 需求
[描述具体需求]

### Claude建议
[记录主要建议和方案]

### 实现结果
[记录实际实现情况]

### 经验总结
[记录有价值的经验和教训]
```

### 知识积累

将有价值的协作经验添加到项目知识库：

```bash
# 将协作经验添加到知识库
echo "## 开发经验 - $(date)" >> .kiro/serena/knowledge/project-knowledge-base.md
echo "[记录重要的开发经验]" >> .kiro/serena/knowledge/project-knowledge-base.md
```

---
*通过系统化的协作流程，让Serena + Claude成为你最强大的开发伙伴！*