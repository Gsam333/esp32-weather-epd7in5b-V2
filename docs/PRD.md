# ESP32 电子墨水屏天气显示器 - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品简介

ESP32电子墨水屏天气显示器是一款低功耗、长续航的智能家居天气显示设备，通过WiFi连接互联网获取实时天气数据，并在电子墨水屏上清晰展示。设备采用ESP32微控制器和7.5英寸电子墨水屏，配合BME280/BME680传感器监测室内环境参数，为用户提供全面的天气信息服务。

### 1.2 目标用户

- 智能家居爱好者
- 天气信息关注者
- DIY电子项目爱好者
- 需要低功耗长续航显示设备的用户
- 喜欢极简设计的用户

### 1.3 产品价值

- **低功耗**：深度睡眠模式下仅消耗约14μA电流，单次充电可持续使用6-12个月
- **信息全面**：同时显示室外天气预报和室内环境数据
- **视觉舒适**：电子墨水屏无闪烁、无辐射，类似纸张的阅读体验
- **高度可定制**：支持多语言、多种单位制、多种显示格式
- **环保节能**：低功耗设计减少能源消耗，电子墨水屏仅在刷新时消耗电力

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 天气数据显示
- 当前天气状况（温度、体感温度、天气图标）
- 5天天气预报（每日最高/最低温度、天气图标）
- 24小时天气预报图表（温度曲线、降水概率）
- 日出/日落时间
- 风速和风向
- 湿度和气压
- 能见度
- 紫外线指数
- 空气质量指数

#### 2.1.2 室内环境监测
- 室内温度
- 室内湿度
- 室内气压（可选）

#### 2.1.3 系统状态显示
- 电池电量
- WiFi信号强度
- 上次更新时间
- 错误状态指示

### 2.2 扩展功能

#### 2.2.1 电源管理
- 低电量警告
- 自适应睡眠时间
- 夜间节电模式

#### 2.2.2 错误处理
- WiFi连接错误提示
- API错误提示
- 时间同步错误提示
- 低电量错误提示

#### 2.2.3 LED状态指示
- API请求状态指示
- 数据处理状态指示
- 睡眠状态指示

## 3. 技术规格

### 3.1 硬件规格

#### 3.1.1 主控制器
- 型号：FireBeetle 2 ESP32-E
- 处理器：ESP32双核处理器
- 内存：520KB SRAM
- 存储：4MB Flash
- 无线连接：WiFi 802.11 b/g/n
- 电源接口：USB-C
- 电池管理：内置充电和保护电路

#### 3.1.2 显示屏
- 类型：电子墨水屏（E-Paper）
- 尺寸：7.5英寸
- 分辨率：800×480像素
- 颜色：黑/白（可选红/黑/白三色或七色）
- 刷新时间：约2-3秒
- 视角：近180°全视角

#### 3.1.3 传感器
- 型号：BME280/BME680
- 测量参数：温度、湿度、气压
- 温度精度：±0.5°C
- 湿度精度：±3%
- 气压精度：±1hPa

#### 3.1.4 电源
- 电池类型：3.7V锂聚合物电池
- 电池容量：推荐5000mAh
- 连接器：JST-PH2.0
- 工作电流：睡眠模式约14μA，刷新时约83mA
- 续航时间：6-12个月（30分钟更新频率）

### 3.2 软件规格

#### 3.2.1 开发环境
- 平台：PlatformIO
- 编程语言：C++
- 开发IDE：Visual Studio Code

#### 3.2.2 依赖库
- GxEPD2：电子墨水屏驱动
- ArduinoJson：JSON解析
- WiFi/HTTPClient：网络通信
- Adafruit_Sensor/Adafruit_BME280：传感器驱动
- Time：时间管理

#### 3.2.3 API集成
- OpenWeatherMap Current Weather API
- OpenWeatherMap Forecast API
- OpenWeatherMap Air Pollution API
- NTP时间服务器

#### 3.2.4 配置选项
- 显示语言：支持多种语言
- 温度单位：摄氏度/华氏度/开尔文
- 时间格式：12小时制/24小时制
- 日期格式：可自定义
- 更新频率：可配置（推荐30分钟）
- 节电模式：可设置夜间休眠时段

## 4. 用户体验

### 4.1 显示界面

#### 4.1.1 主界面布局
- 左上角：当前天气图标和温度
- 右上角：城市名称和日期
- 左侧：当前天气详细信息（体感温度、日出/日落、风速等）
- 右侧：5天天气预报
- 底部：24小时天气预报图表
- 左下角：室内环境数据
- 底部状态栏：上次更新时间、WiFi信号、电池状态

#### 4.1.2 错误界面
- 低电量错误：显示电池警告图标和文字
- WiFi错误：显示WiFi错误图标和连接状态
- API错误：显示云端错误图标和错误代码
- 时间错误：显示时钟错误图标和错误信息

### 4.2 交互方式

- 自动更新：设备按照配置的时间间隔自动更新数据
- 手动更新：通过按下重置按钮触发立即更新
- 状态指示：通过LED指示灯显示当前工作状态
- 配置更新：通过修改代码和重新上传实现配置变更

## 5. 实现要求

### 5.1 硬件实现

#### 5.1.1 组件清单
- FireBeetle 2 ESP32-E微控制器
- 7.5英寸电子墨水屏
- DESPI-C02适配板
- BME280/BME680传感器
- 3.7V锂电池（JST-PH2.0接口）
- 连接线
- 外壳（可3D打印或使用木质外壳）

#### 5.1.2 接线图
- ESP32与电子墨水屏连接
  - BUSY: GPIO25
  - CS: GPIO15
  - RST: GPIO26
  - DC: GPIO27
  - SCK: GPIO13
  - MOSI: GPIO14
  - MISO: GPIO12（可选）
  - PWR: GPIO26（可选，如直接连接3.3V则不需要）

- ESP32与BME280/BME680连接
  - SDA: GPIO17
  - SCL: GPIO16
  - PWR: GPIO4（可选，如直接连接3.3V则不需要）

- ESP32与LED指示灯连接
  - LED1: GPIO2

### 5.2 软件实现

#### 5.2.1 代码结构
- config.h/config.cpp：配置参数定义
- main.cpp：主程序入口和流程控制
- client_utils.cpp：网络通信和API请求
- api_response.cpp：API响应解析
- display_utils.cpp：显示辅助函数
- renderer.cpp：界面渲染

#### 5.2.2 主要流程
1. 系统初始化
2. 电池电量检查
3. WiFi连接
4. 时间同步
5. API数据获取
6. 传感器数据读取
7. 显示渲染
8. 进入深度睡眠

#### 5.2.3 低功耗策略
- 使用ESP32深度睡眠模式
- 禁用不必要的外设
- 优化唤醒频率
- 实现夜间节电模式
- 根据电池电量调整更新频率

## 6. 测试要求

### 6.1 功能测试

- 天气数据获取测试
- 传感器数据读取测试
- 显示渲染测试
- 电池电量监测测试
- 深度睡眠和唤醒测试
- LED指示灯功能测试

### 6.2 性能测试

- 电池续航测试
- 数据更新时间测试
- 显示刷新速度测试
- 内存使用测试
- WiFi连接稳定性测试

### 6.3 错误处理测试

- 网络断开测试
- API错误测试
- 低电量测试
- 传感器故障测试
- 时间同步失败测试

## 7. 部署指南

### 7.1 环境准备

- 安装Visual Studio Code
- 安装PlatformIO扩展
- 克隆或下载项目代码

### 7.2 配置步骤

1. 修改secrets.h文件，设置WiFi凭据和API密钥
2. 根据需求修改config.cpp和config.h中的配置参数
3. 连接ESP32到计算机
4. 使用PlatformIO编译并上传代码
5. 监控串口输出确认设备正常工作

### 7.3 硬件组装

1. 按照接线图连接ESP32、电子墨水屏和传感器
2. 安装电池
3. 将组件安装到外壳中
4. 测试设备功能

## 8. 维护与升级

### 8.1 常见问题

- 显示不更新：检查电池电量和WiFi连接
- 室内数据不显示：检查传感器连接
- 天气数据错误：验证API密钥和网络连接
- 电池续航短：检查睡眠模式配置和更新频率

### 8.2 升级路径

- 固件更新：通过USB连接上传新版本代码
- 配置更新：修改配置文件并重新上传
- 硬件升级：支持更换不同型号的电子墨水屏和传感器

## 9. 项目时间线

### 9.1 开发阶段

1. **需求分析与设计**：1周
   - 确定功能需求
   - 选择硬件组件
   - 设计系统架构

2. **硬件组装**：1周
   - 采购组件
   - 连接电路
   - 测试硬件功能

3. **软件开发**：2-3周
   - 实现核心功能
   - 优化低功耗策略
   - 完善错误处理

4. **测试与优化**：1-2周
   - 功能测试
   - 性能测试
   - 电池续航测试

5. **文档编写**：1周
   - 编写用户手册
   - 完善技术文档
   - 准备部署指南

### 9.2 发布计划

- **Alpha版本**：基本功能实现，支持天气显示和传感器读取
- **Beta版本**：优化低功耗策略，完善错误处理
- **正式版本**：全功能支持，包括多语言和多种配置选项

## 10. 附录

### 10.1 参考资料

- [ESP32官方文档](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/)
- [OpenWeatherMap API文档](https://openweathermap.org/api)
- [GxEPD2库文档](https://github.com/ZinggJM/GxEPD2)
- [电子墨水屏规格书](https://www.waveshare.net/wiki/7.5inch_e-Paper_HAT)

### 10.2 术语表

- **ESP32**：乐鑫科技开发的低功耗WiFi和蓝牙双模微控制器
- **E-Paper**：电子墨水屏，一种仅在刷新时消耗电力的显示技术
- **BME280/BME680**：博世开发的环境传感器，可测量温度、湿度和气压
- **API**：应用程序接口，用于软件组件之间的通信
- **NTP**：网络时间协议，用于同步计算机时钟
- **深度睡眠**：微控制器的低功耗模式，关闭大部分功能以节省电力

---

*文档版本：1.0*  
*最后更新：2025年7月22日*